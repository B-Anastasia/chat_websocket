(this.webpackJsonpchat_websocket=this.webpackJsonpchat_websocket||[]).push([[0],{48:function(e,t,n){},49:function(e,t,n){},77:function(e,t){},80:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n(0),i=n.n(c),o=n(13),r=n.n(o),a=(n(48),n(8)),u=(n(49),n(82)),l=n(6),d=n(26),b=n(2),j=n(41),f=n.n(j),g={socket:null,createConnection:function(){this.socket=f()("https://chat-back-io.herokuapp.com/")},subscribe:function(e,t,n){var s,c,i;null===(s=this.socket)||void 0===s||s.on("init-messages-published",e),null===(c=this.socket)||void 0===c||c.on("new-message-sent",t),null===(i=this.socket)||void 0===i||i.on("user-typing",n)},destroyConnection:function(){var e;null===(e=this.socket)||void 0===e||e.disconnect(),this.socket=null},sendName:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-name-sent",e)},sendMessage:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-message-sent",e,(function(e){e&&alert(e)}))},typeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-typed")}},h={messages:[],typingUsers:[]};var O=function(){console.log("rendered");var e=Object(l.c)((function(e){return e.chat.messages})),t=Object(l.c)((function(e){return e.chat.typingUsers})),n=Object(l.b)(),i=Object(c.useState)("Hello"),o=Object(a.a)(i,2),r=o[0],d=o[1],b=Object(c.useState)("Nastya"),j=Object(a.a)(b,2),f=j[0],h=j[1],O=Object(c.useState)(!0),m=Object(a.a)(O,2),v=m[0],p=m[1],y=Object(c.useState)(0),k=Object(a.a)(y,2),x=k[0],C=k[1],w=Object(c.useRef)(null);return Object(c.useEffect)((function(){return n((function(e){g.createConnection(),g.subscribe((function(t,n){e(function(e){return{type:"messages-received",messages:e}}(t)),n("data from front")}),(function(t){e(function(e){return{type:"new-message-received",message:e}}(t))}),(function(t){e(function(e){return{type:"typing-user-added",user:e}}(t))}))})),function(){n((function(e){g.destroyConnection()}))}}),[n]),Object(c.useEffect)((function(){var e;v&&(null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[e,t,v]),Object(s.jsx)("div",{className:"App",children:Object(s.jsxs)("div",{className:"App-content",children:[Object(s.jsxs)("div",{className:"messages",onScroll:function(e){var t=e.currentTarget,n=t.scrollHeight-t.clientHeight;t.scrollTop>x&&Math.abs(n-t.scrollTop)<10?p(!0):p(!1),C(t.scrollTop)},children:[e.map((function(e){return Object(s.jsxs)("div",{children:[Object(s.jsxs)("b",{children:[e.name,":"]}),e.message]},Object(u.a)())})),t.map((function(e){return Object(s.jsxs)("div",{children:[Object(s.jsx)("b",{children:e.name})," ..."]})})),Object(s.jsx)("div",{ref:w})]}),Object(s.jsxs)("div",{children:[Object(s.jsx)("input",{value:f,onChange:function(e){return h(e.currentTarget.value)}}),Object(s.jsx)("button",{onClick:function(){n(function(e){return function(t){g.sendName(e)}}(f))},children:"Send name"})]}),Object(s.jsxs)("div",{className:"message",children:[Object(s.jsx)("textarea",{value:r,onKeyPress:function(){n((function(e){g.typeMessage()}))},onChange:function(e){return d(e.currentTarget.value)},cols:20,rows:5}),Object(s.jsx)("button",{onClick:function(){n(function(e){return function(t){g.sendMessage(e)}}(r)),d("")},children:"Send"})]})]})})},m=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,83)).then((function(t){var n=t.getCLS,s=t.getFID,c=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),s(e),c(e),i(e),o(e)}))},v=n(5),p=n(42),y=Object(v.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"messages-received":return Object(b.a)(Object(b.a)({},e),{},{messages:t.messages});case"new-message-received":return Object(b.a)(Object(b.a)({},e),{},{messages:[].concat(Object(d.a)(e.messages),[t.message]),typingUsers:e.typingUsers.filter((function(e){return e.id!==t.message.userId}))});case"typing-user-added":return Object(b.a)(Object(b.a)({},e),{},{typingUsers:[].concat(Object(d.a)(e.typingUsers.filter((function(e){return e.id!==t.user.id}))),[t.user])});default:return e}}}),k=Object(v.d)(y,Object(v.a)(p.a));k.subscribe((function(){console.log("state changed")})),k.subscribe((function(){console.log("state changed 1")})),r.a.render(Object(s.jsx)(i.a.StrictMode,{children:Object(s.jsx)(l.a,{store:k,children:Object(s.jsx)(O,{})})}),document.getElementById("root")),m()}},[[80,1,2]]]);
//# sourceMappingURL=main.b0443def.chunk.js.map